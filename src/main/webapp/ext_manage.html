<!DOCTYPE html>
<html>
    <head>
        <title>ExtJS的例子</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/framework/jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
        <script src="extjs/ext-all-debug.js" type="text/javascript"></script>
        <script src="extjs/ext-theme-neptune.js" type="text/javascript"></script>
        <link href="extjs/ext-theme-neptune/ext-theme-neptune-all-debug.css" rel="stylesheet" type="text/css"/>
        <script src="js/jquery.serializeObject.js" type="text/javascript"></script>
        <script src="js/ur/framework/gaea-common.js" type="text/javascript"></script>
        <script src="js/ur/framework/gaea-common-utils.js" type="text/javascript"></script>
        <script>
            var grid;
            var store;
            $(function() {
                Ext.define('Product', {
                    extend: 'Ext.data.Model',
                    idProperty: "productId",
                    fields: ['productId', 'name', 'description', 'status', 'lastPrice', 'createTime']
                });

                store = Ext.create('Ext.data.Store', {
                    model: 'Product',
                    autoLoad: true,
                    proxy: {
                        type: 'ajax',
                        url: '/product/list-all.do',
                        reader: {
                            type: 'json'
                        }
                    }
                });

// ----------------------------------------------------- 网上找的EXTJS的例子。 v1 -----------------------------------------------------
//                var arrayData = [
//                    ['Jay Garcia', 'MD', 'MD', 'MD'],
//                    ['Aaron Baker', 'VA', 'MD', 'MD'],
//                    ['Susan Smith', 'DC', 'MD', 'MD'],
//                    ['Mary Stein', 'DE', 'MD', 'MD'],
//                    ['Bryan Shanley', 'NJ', 'MD', 'MD'],
//                    ['Nyri Selgado', 'CA', 'MD', 'MD']
//                ];
//                var store = Ext.create('Ext.data.ArrayStore', {
//                    data: arrayData,
//                    fields: ['name', 'description', 'status', 'lastPrice'] // 如果下面的dataIndex写的是name，则加载name列的数据；如果写的是status，则加载status的数据。
//                });
                grid = Ext.create('Ext.grid.Panel', {
                    title: 'Our first grid',
                    renderTo: "gridDemo",
                    autoHeight: true,
//                    width: 250,
                    store: store,
                    selType: 'rowmodel',
                    singleSelect: true,
                    columns: [
                        {
                            header: '产品名称',
                            sortable: true,
                            dataIndex: 'name'
                        },
                        {
                            header: '产品描述',
                            dataIndex: 'description'
                        },
                        {
                            header: '产品状态',
                            dataIndex: 'status'
                        },
                        {
                            header: '价格',
                            dataIndex: 'lastPrice'
                        },
                        {
                            header: '创建时间',
                            dataIndex: 'createTime',
                            renderer: function(value, row) {
//                    alert(ur.common.utils.validate.isNotNull(value));
                                if (ur.common.utils.validate.isNotNull(value)) {
                                    return Ext.util.Format.date(new Date(parseInt(value)), 'Y-m-d')
                                } else {
                                    return "";
                                }
                            }
                        }
                    ]
                });
            });

// ----------------------------------------------------- 网上找的EXTJS的例子。 v2 -----------------------------------------------------
////User类，创立一个模型类
//            Ext.define("user", {
//                extend: "Ext.data.Model",
//                fields: [
//                    {name: 'name', type: 'string', sortable: true},
//                    {name: 'age', type: 'int', sortable: true},
//                    {name: 'email', type: 'string', sortable: true}
//                ]
//            });
////User对象
//            var user = Ext.create("user", {});
//            Ext.create("Ext.data.Store", {
//                model: 'user', //这个地方user不是一个对象，而是一个类
//                storeId: 's_user', //写了以后就可以把store用StroeManager进行管理
//                proxy: {//代理
//                    type: 'ajax',
//                    url: '获取数据的url，后台请大家自己实现',
//                    reader: {//读取器
//                        type: 'json', //类型
//                        root: 'topics'//根节点
//                    },
//                    writer: {
//                        type: 'json'
//                    }
//                },
//                autoLoad: true
//            });
//
//
            Ext.onReady(function() {
// ----------------------------------------------------- 日期选择输入框 -----------------------------------------------------
                Ext.create("Ext.form.field.Date", {
                    name: "createTime",
                    renderTo: "div-create-time"
                });
// ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                //初始化
//                Ext.QuickTips.init();//类似于title，用于显示ext:qtip设定的值
//                //创建表格时候要 用表格的面板
//                var grid = Ext.create("Ext.grid.Panel", {
//                    title: 'Grid Demo', //标题
//                    frame: true, //面板渲染，使表格更加饱满
//                    //forceFit : true,//自动填充panel空白处
//                    width: 600,
//                    height: 280,
//                    columns: [//列模式
//                        {text: "Name", dataIndex: 'name', width: 100}, //text列名，表头信息
//                        {text: "age", dataIndex: 'age', width: 100}, //dataIndex从store/model中找到相应的记录
//                        {text: "email", dataIndex: 'email', width: 350,
//                            //重构列模式
//                            field: {
//                                xtype: 'textfield', //编辑方式
//                                allowBlank: false//
//                            }
//                        }
//                    ],
//                    tbar: [
//                        {xtype: 'button', text: '添加', iconCls: 'table_add'}, //这个地方iconCls是一些图标组件，大家可以自行添加
//                        {xtype: 'button', text: '删除', iconCls: 'table_remove',
//                            handler: function(o) {
//                                //var gird = o.findParentByType("gridpanel");
//                                var gird = o.ownerCt.ownerCt;//ownerCt是拥有这个组件的组件
//                                var data = gird.getSelectionModel().getSelection();
//                                //getSelectionModel得到Ext.selection.Model对象，得到选择模式
//                                //Ext.selection.Model中有getSelection方法得到选中对象的数组
//                                if (data.length == 0) {
//                                    Ext.Msg.alert("提示", "您最少要选择一条数据");
//                                } else {
//                                    //1.先得到ID的数据(name)
//                                    var st = gird.getStore();//得到store
//                                    var ids = [];
//                                    Ext.Array.each(data, function(record) {
//                                        ids.push(record.get('name'));
//                                    })
//                                    //2.后台操作(delete)
//                                    Ext.Ajax.request({
//                                        url: '/extjs/extjs!deleteData.action',
//                                        params: {ids: ids.join(",")},
//                                        method: 'POST',
//                                        timeout: 2000, //延迟显示
//                                        success: function(response, opts) {
//                                            Ext.Array.each(data, function(record) {
//                                                st.remove(record);
//                                            })
//                                        }
//                                    })
//                                    //3.前端操作DOM进行删除(ExtJs)
//                                }
//                            }
//                        },
//                        {xtype: 'button', text: '修改', iconCls: 'table_edit'},
//                        {xtype: 'button', text: '查看', iconCls: 'table_comm'}
//                    ],
//                    dockedItems: [{//控制组件在什么位置，随便定位
//                            xtype: 'pagingtoolbar', //分页组件
//                            store: Ext.data.StoreManager.lookup('s_user'), //分页也跟数据、挂钩
//                            dock: 'bottom', //位置
//                            displayInfo: true
//                        }],
//                    plugins: [//Ext 4.0用的是 插件的形式来和form表单配合使用的
//                        Ext.create("Ext.grid.plugin.CellEditing", {
//                            clicksToEdit: 1
//                        })
//                    ],
//                    selType: 'checkboxmodel', //设定选择模式，前边会加选择框
//                    multiSelect: true, //运行多选
//                    renderTo: 'gridDemo', //把这个组件渲染到一个div上
//                    store: Ext.data.StoreManager.lookup('s_user')//通过StoreManager读取数据
//                });


                // ----------------------------------------------------- 工具栏test -----------------------------------------------------
                Ext.create('Ext.toolbar.Toolbar', {
                    renderTo: "tool-bar",
//                    width: 600, // 不设置为100%
                    items: [
                        {
                            // xtype: 'button', // default for Toolbars
                            text: '新增', iconCls: "drop-add",
                            handler: function() {
                                prepareAdd();
                            }
                        }, {
                            text: '修改', iconCls: "edit",
                            handler: function() {
                                update();
                            }
                        }, {
                            text: '删除', iconCls: "drop-no",
                            handler: function() {
                                del();
                            }
                        }
//                        ,
//                        {
//                            xtype: 'splitbutton',
//                            text: 'Split Button'
//                        },
//                        // begin using the right-justified button container
//                        '->', // same as { xtype: 'tbfill' }
//                        {
//                            xtype: 'textfield',
//                            name: 'field1',
//                            emptyText: 'enter search term'
//                        },
//                        // add a vertical separator bar between toolbar items
//                        '-', // same as {xtype: 'tbseparator'} to create Ext.toolbar.Separator
//                        'text 1', // same as {xtype: 'tbtext', text: 'text1'} to create Ext.toolbar.TextItem
//                        {xtype: 'tbspacer'}, // same as ' ' to create Ext.toolbar.Spacer
//                        'text 2',
//                        {xtype: 'tbspacer', width: 50}, // add a 50px space
//                        'text 3'
                    ]
                });
            });
// ----------------------------------------------------- 弹出框test -----------------------------------------------------
            function prepareAdd() {
                var addWindow = Ext.create('Ext.window.Window', {
                    title: 'Hello',
                    height: 300,
                    width: 400,
                    layout: 'form', // Iverson setting
//                    layout: 'fit',
                    contentEl: "div-add-form", // 内容的来源，html。自定义的表单。
                    buttons: [
                        {
                            text: "确定",
                            handler: function() {
                                // ---------------------- form data 请求方式 ----------------------
                                $.post("/product/save.do",
                                        $("#add-form").serializeObject(),
                                        function() {
                                            alert("新增成功");
                                            addWindow.hide();
                                        }).fail(function() {
                                    alert("新增失败");
                                    addWindow.hide();
                                });
                            }
                        },
                        {
                            text: "取消",
                            handler: function() {
                                addWindow.hide();
                            }
                        }]
                }).show();
            }

            function update() {
                var record = grid.getSelectionModel().getSelection()[0].data;
                $("#productId").val(record.productId);
                $("#name").val(record.name);
                $("#description").val(record.description);
                $("#status").val(record.status);
                $("#lastPrice").val(record.lastPrice);
                // Iverson test
                var editWindow = Ext.create('Ext.window.Window', {
                    title: 'Hello',
                    height: 200,
                    width: 400,
                    layout: 'form', // Iverson setting
//                    layout: 'fit',
                    contentEl: "div-add-form",
                    buttons: [
                        {
                            text: "确定",
                            handler: function() {
                                // ---------------------- form data 请求方式 ----------------------
                                $.post("/product/update.do",
                                        $("#add-form").serializeObject(),
                                        function() {
                                            alert("修改成功");
                                            store.load();
                                            editWindow.hide();
                                        }).fail(function() {
                                    alert("修改失败");
                                    editWindow.hide();
                                });
                            }
                        },
                        {
                            text: "取消",
                            handler: function() {
                                editWindow.hide();
                            }
                        }]
                }).show();
            }

            function del() {
//                alert(grid.getSelectionModel().getSelection()[0].data.name);
                var pId = grid.getSelectionModel().getSelection()[0].getId();
                var delWindow = Ext.create('Ext.window.Window', {
                    title: '删除确认',
                    height: 200,
                    width: 400,
                    layout: 'fit', // Iverson setting
                    html: "是否确定删除？",
                    buttons: [
                        {
                            text: "确定",
                            handler: function() {
                                $.post("/product/delete.do",
                                        {productId: pId},
                                function() {
                                    alert("删除成功");
                                    store.load();
                                    delWindow.hide();
                                }).fail(function() {
                                    alert("删除失败");
                                    delWindow.hide();
                                });
                            }
                        },
                        {
                            text: "取消",
                            handler: function() {
                                delWindow.hide();
                            }
                        }]
                }).show();
            }
//            Ext.onReady(function(){
//                Ext.create('Ext.panel.Panel', {
//    title: 'Hello',
//    width: 200,
//    contentEl:"add-form"
//    renderTo: "mypanel"
//});
//            });


        </script>
        <style>
            #tool-bar{
                height: 50px;
            }
            #gridDemo{
                height: 600px;
            }
            .drop-yes {
                background-image: url(extjs/ext-theme-neptune/images/dd/drop-yes.png);
            }
            .drop-add {
                background-image: url(extjs/ext-theme-neptune/images/dd/drop-add.png);
            }
            .drop-no {
                background-image: url(extjs/ext-theme-neptune/images/dd/drop-no.png);
            }
            .edit {
                background-image: url(extjs/ext-theme-neptune/images/dd/edit.png);
            }
        </style>
    </head>
    <body>
        <div>
            <div><h2>产品管理</h2></div>
            <div>
                <div id="tool-bar">
                </div>
                <div id="gridDemo"></div>
            </div>
            <div id="mypanel"></div>
            <!--x-hidden，ExtJs4的CSS。隐藏当前的元素-->
            <div id="div-add-form" class="x-hidden">
                <form name="add-form" id="add-form">
                    <input type="hidden" id="productId" name="productId" value="">
                    <table>
                        <tr>
                            <td>产品名称：</td><td><input type="text" id="name" name="name"></td>
                        </tr>
                        <tr>
                            <td>产品描述：</td><td><input type="text" id="description" name="description"></td>
                        </tr>
                        <tr>
                            <td>产品状态：</td>
                            <td>
                                <select id="status" name="status">
                                    <option value="0">无效</option>
                                    <option value="1" selected="selected">有效</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>价格：</td><td><input type="text" id="lastPrice" name="lastPrice"></td>
                        </tr>
                        <tr>
                            <td>创建日期：</td><td><div id="div-create-time"></div></td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </body>
</html>
